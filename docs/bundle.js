!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";function a(e,t){return Math.floor(function(e,t){return e+(t-e)*Math.random()}(e,t))}function r(e){return e[a(0,e.length)]}function i(e,t,n){return Math.max(e,Math.min(n,t))}n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i}))},function(e,t,n){var a={"./bass.js":2,"./drums.js":3,"./melody.js":4};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=1},function(e,t,n){"use strict";n.r(t);var a=n(0);t.default=function(e,t){t({pan:-.5},e=>{e.program=r;var t=40;e.onBeat=(n,r)=>{t+=Object(a.b)(1,5)*Object(a.c)([1,-1]),t=Object(a.a)(36,t,45),e.playSound(t,.8)}})};var r=[{type:"sine",freq:{type:"sine",freq:{t:3},gain:{t:4,a:.02,h:.01,d:.3,s:0,r:.05}},gain:{t:.5,a:0,h:.01,d:.3,s:0,r:.2}}]},function(e,t,n){"use strict";n.r(t);var a=n(0);t.default=function(e,t){t({},e=>{e.program=r,e.onBeat=(t,n)=>{e.playPattern(t,n,45,"#------# #")}}),t({pan:-.2},e=>{e.program=i,e.onBeat=(t,n)=>{e.playPattern(t,n,55,"-#-#")}}),t({pan:.3},e=>{var t="-#-#-#-#",n=["-#-#","#-#-","--##","##-#"];e.program=s,e.onBeat=(r,i)=>{0===i&&(t=Object(a.c)(n)+Object(a.c)(n)),e.playPattern(r,i,77,t)}})};var r=[{type:"sine",freq:{p:.3,q:.1},gain:{a:.01,h:0,s:0,d:.1,r:.1}},{type:"square",freq:{t:.5},gain:{t:.2,a:.01,h:0,s:0,d:.05,r:.02}}],i=[{type:"triangle",freq:{p:.5},gain:{t:.3,a:0,h:.03,d:.05,s:0,r:.05}},{type:"n0",gain:{t:.6,a:0,h:.02,d:.01,s:0,r:.01}}],s=[{type:"n1",gain:{t:.2,a:0,s:0,h:0,d:.04,r:.05}},{type:"highpass",freq:{t:2}}]},function(e,t,n){"use strict";n.r(t);var a=n(0);t.default=function(e,t){t({pan:.5},e=>{e.program=r;var t=70;e.onBeat=(n,r)=>{t+=Object(a.b)(1,3)*Object(a.c)([1,-1]),t=Object(a.a)(62,t,88),e.playSound(t,.35),Object(a.c)([0,1])&&(t+=Object(a.b)(-3,4),e.playSound(t,.35,.5))}})};var r=[{type:"tri",gain:{t:.6,k:-.2}}]},function(e,t,n){"use strict";function a(e,t,n){if(!e)throw"Scheduler needs an AudioContext!";var a=this;this.bpm=t||60,this.playing=!1,this.context=e,this.beatsToSeconds=e=>60*+e/a.bpm,this.onBeat=()=>{},n=n||.2;var r=0;setInterval(()=>{if(a.playing)for(var t=e.currentTime,i=60/a.bpm,s=r+i;s<=t+n;){var o=s<=t?t+.01:s;a.onBeat(o-t),r=o,s=o+i}},1e3*n/3)}function r(e,t,n,a){var r=typeof n;a=a||(()=>{}),Object.defineProperty(e,t,{get:()=>n,set:e=>{"number"===r&&(e=+e),"boolean"===r&&(e=!!e),a(n=e)}})}n.r(t);var i={usesFreq:!0,usesGain:!1,usesQ:!1};var s,o={pe:"peaking",ba:"bandpass",no:"notch",al:"allpass",lo:"lowpass",hi:"highpass",lowsh:"lowshelf",highs:"highshelf"},u={lowpass:"fq",highpass:"fq",bandpass:"fq",lowshelf:"fg",highshelf:"fg",peaking:"fqg",notch:"fq",allpass:"fq"};function l(e,t){var n;return s!==e&&(s=e,p={},f={}),"w"===(t=t.toLowerCase())[0]&&(n=function(e){var t=s.createOscillator();e.length<2&&(e+="9");return t.setPeriodicWave(function(e){if(!p[e]){for(var t=new Float32Array(e.length),n=new Float32Array(e.length),a=1;a<e.length;++a){var r=parseFloat(e[a])/9;t[a]=r*r}p[e]=s.createPeriodicWave(n,t)}return p[e]}(e)),t}(t)),"p"===t[0]&&(n=function(e){var t=Math.round(parseInt(e.substr(1))||50);t=Math.min(Math.max(t,1),99);var n=s.createOscillator();n.type="sawtooth";var a=s.createWaveShaper();return a.curve=function(e){if(h[e])return h[e];for(var t=new Float32Array(256),n=256*e/100,a=0;a<256;a++)t[a]=a<n?1:-1;return h[e]=t}(t),n.connect(a),{start:e=>n.start(e),frequency:n.frequency,connect:e=>a.connect(e),disconnect:()=>{a.disconnect(),n.disconnect(),n.stop()},input:n}}(t)),"n"===t[0]&&(n=function(e){var t=s.createBufferSource(),n="n0";/p/.test(e)&&(n="np");/1/.test(e)&&(n="n1");f[n]||(f[n]=function(e){var t={n0:1,n1:1.5,np:2}[e]*s.sampleRate|0,n=s.createBuffer(1,t,s.sampleRate),a=n.getChannelData(0);"n0"===e&&function(e){for(var t=0;t<e.length;t++)e[t]=2*Math.random()-1}(a);"np"===e&&function(e){for(var t=0,n=0,a=0,r=0;r<e.length;r++){var i=2*Math.random()-1;t=.99765*t+.099046*i,n=.963*n+.2965164*i,a=.57*a+1.0526913*i,e[r]=t+n+a+.1848*i}}(a);"n1"===e&&function(e){for(var t=d(1),n=0;n<24;n++){t=d(t),v(e,1+n%16,2+10*t,.25)}m=null}(a);return n}(n));return t.buffer=f[n],t.loop=!0,t}(t)),n||(n=function(e){var t=s.createOscillator();return t.type="t"===e[0]?"triangle":c[e.substr(0,2)]||"sine",t}(t)),n}var c={si:"sine",sq:"square",sa:"sawtooth",tr:"triangle"};var h={};var p={};var f={};var v=(e,t,n,a)=>{for(var r=2*Math.PI*440/s.sampleRate,i=2*Math.random()*Math.PI,o=2*Math.random()*Math.PI,u=0;u<e.length;u++){var l=u*r,c=m(i+t*l),h=m(o+n*l);e[u]+=c*h*a}};function d(e){return(e=(e+Math.sqrt(17))*Math.sqrt(23))-Math.floor(e)}var m=(()=>{for(var e=[],t=512/(2*Math.PI),n=0;n<512;n++)e[n]=Math.sin(n/t);return n=>e[n*t&511]})();class g{constructor(e){this.ctx=e,this.zeroRampTarget=.001}initParam(e,t){var n=this.ctx.currentTime;e.cancelScheduledValues(0),e.setValueAtTime(t,0),n>0&&e.setValueAtTime(t,n),e.__paramEnveloperEvents=[new _(y,t,t,0,n)],E("init:  param base set to",t,"time 0")}startEnvelope(e,t){x(e,this.ctx.currentTime),function(e,t){var n=e.__paramEnveloperEvents,a=n[n.length-1];if(t<=a.t1)return;var r=a.v1;e.setValueAtTime(r,t),n.push(new _(y,r,r,a.t1,t))}(e,t=Math.max(t,this.ctx.currentTime));var n=e.__paramEnveloperEvents,a=M(n,t);n.length=n.indexOf(a)+1,t>0&&e.cancelScheduledValues(t);var r=q(a,t);a.t1=t,a.v1=r,a.type===y?e.setValueAtTime(r,t):a.type===b?e.linearRampToValueAtTime(r,t):a.type===T?(r=r||this.zeroRampTarget,e.exponentialRampToValueAtTime(r,t)):a.type,E("start: new envelope from time",t,"val",r)}addHold(e,t){if(t>0){x(e,this.ctx.currentTime);var n=e.__paramEnveloperEvents,a=n[n.length-1];if(a.t1===1/0){var r=a.t0+t;this.startEnvelope(e,r),E("hold:  broke open sweep at time",r)}else{var i=a.v1,s=a.t1,o=i,u=s+t;n.push(new _(y,i,o,s,u)),e.setValueAtTime(i,u),E("hold:  at val",i,"until time",u)}}}addRamp(e,t,n,a){t>1e-4||(t=1e-4),x(e,this.ctx.currentTime);var r=e.__paramEnveloperEvents,i=r[r.length-1],s=i.v1,o=i.t1;if(i.t1===1/0)throw"Error - change scheduled after a sweep with infinite duration";var u=n,l=o+t;a?(s=s||this.zeroRampTarget,u=u||this.zeroRampTarget,e.exponentialRampToValueAtTime(u,l)):e.linearRampToValueAtTime(u,l);var c=a?T:b;r.push(new _(c,s,u,o,l)),E("ramp:  to val",u,"time",l)}addSweep(e,t,n,a){x(e,this.ctx.currentTime);var r,i,s=e.__paramEnveloperEvents,o=s[s.length-1],u=o.v1,l=o.t1;if(o.t1===1/0)throw"Error - change scheduled after a sweep with infinite duration";e.setTargetAtTime(n,l,a),t>0?(r=l+t,i=S(t,u,n,a)):(r=1/0,i=n);var c=new _(w,u,i,l,r);c.k=a,c.tgt=n,s.push(c),E("sweep: to target",n,"time",r)}getValueAtTime(e,t){x(e,this.ctx.currentTime);var n=M(e.__paramEnveloperEvents,t);return t>n.t1?n.v1:q(n,t)}}var y=1,w=2,b=3,T=4;function _(e,t,n,a,r){this.type=e,this.v0=+t,this.v1=+n,this.t0=+a,this.t1=+r,this.k=.1,this.tgt=.1}function x(e,t){var n=e.__paramEnveloperEvents,a=n[n.length-1],r=-1;if(n.some((e,n)=>{if(e.t1<=t)return!0;r=n}),r>=0&&n.splice(0,r+1),0===n.length){var i=a.v1;e.setValueAtTime(i,t),n.push(new _(y,i,i,0,t))}}function M(e,t){var n=null;if(e.some(e=>{if(n=e,t<e.t1)return!0}),!n)throw"Internal problem, time not within event list";return n}function q(e,t){if(e.type===y)return e.v0;var n=t-e.t0;return e.type===b?function(e,t,n,a){return t+(n-t)*e/a}(n,e.v0,e.v1,e.t1-e.t0):e.type===T?function(e,t,n,a){return t*Math.pow(n/t,e/a)}(n,e.v0,e.v1,e.t1-e.t0):e.type===w?S(n,e.v0,e.tgt,e.k):void 0}function S(e,t,n,a){return n+(t-n)*Math.exp(-e/a)}var A,E=()=>{};function k(e,t,n,a,r,i,s,o,u){j("start"),j("PARAM: ",s,"time",r,"needsEnv="+u,"now",e.currentTime),A||(A=new g(e));var l="freq"===s?a:1;"gain"===s&&"freq"===o&&(l=a);var c={envStarted:!1,attackRampNeeded:!!u,currValue:l,startTime:r,sweeping:!1,releaseTime:-1,releaseTarget:0},h=Array.isArray(i)?i:[i];if(0===h.length&&h.push({}),h.forEach(i=>{if((i=function(e,t){if(n=e,"number"==typeof n)return"freq"===t?{t:0,f:e}:{t:e};var n;return"object"!=typeof e?{}:e||{}}(i,s)).type){C(e,n,i,a,r,s,!1).connect(t)}else{var o=function(e){V.w=e.w>0?e.w:0,V.t=e.t>=0?e.t:1,V.f=e.f>0?e.f:0,V.k=e.k>0?e.k:0,V.a=e.a>=0?e.a:-1,V.h=e.h>0?e.h:0,V.s=e.s>=0?e.s:R.s,V.d=e.d>=0?e.d:-1,V.r=e.r>=0?e.r:-1,V.z=e.z>0?e.z:-1,e.p>=0&&(V.s=e.p);e.q>=0&&(V.d=e.q);return V}(i);B(t,o,c,a)}}),c.attackRampNeeded&&(j("- default attack ramp:"),B(t,{a:R.a},c,a)),c.envStarted||(j("- no schedules, init to:",c.currValue),A.initParam(t,c.currValue)),u&&c.releaseTime<0&&(c.releaseTime=R.r),c.releaseTime>=0&&(n.envelopes.push({param:t,releaseTime:c.releaseTime,releaseTarget:c.releaseTarget,rootEnvelope:!!u}),j("- stored release:",c.releaseTime,"target",c.releaseTarget)),"freq"===s&&(!o||"freq"===o)){var p=c.currValue/a;0!==p&&n.bendables.push({param:t,mult:p})}c=null,j("end")}var V={};function B(e,t,n,a){var r=n.currValue||1;t.t>=0&&(r*=t.t),r+=t.f||0,t.k&&(r*=Math.pow(a/261.625,t.k));var i=t.w>0,s=t.a>=0,o=t.h>0,u=t.d>=0;if(n.attackRampNeeded&&(o||u)&&(s=!0),(i||s||o||u)&&!n.envStarted){var l=s?n.currValue:r;n.attackRampNeeded&&(l=0),A.initParam(e,l),A.startEnvelope(e,n.startTime),n.envStarted=!0,j("- initted param:",l,"time",n.startTime)}if(i&&(O(n,e,t.w),j("- wait for",t.w)),s){n.sweeping&&O(n,e,0);var c=t.a>=0?t.a:R.a;A.addRamp(e,c,r),n.attackRampNeeded=!1,j("- linear ramp to",r,"over",c)}if(o&&(O(n,e,t.h),j("- wait for",t.h)),u){r*=t.s;var h=t.d>0?t.d:R.d;A.addSweep(e,-1,r,h),j("- open sweep to",r,"const",h)}n.currValue=r,t.r>=0&&(n.releaseTime=t.r),t.z>=0&&(n.releaseTarget=n.currValue*t.z)}function O(e,t,n){A.addHold(t,n||0),e.sweeping=!1}var R={w:0,t:1,f:0,k:0,a:.05,h:0,d:.1,s:.5,r:.1,z:-1},j=()=>{};function C(e,t,n,a,r,s,c){var h=(n=function(e){var t="object"==typeof e?e:{};t.type||(t.type="");return t}(n)).type,p=function(e){var t=e.substr(0,2).toLowerCase();if(!o[t])return null;var n=u[o[t]];return i.usesGain=n.includes("g"),i.usesQ=n.includes("q"),i}(h),f=!p||p.usesGain,v=p?p.usesFreq:!function(e){return/^n/i.test(e)}(h),d=!!p&&p.usesQ;if(p&&s)throw"Filters only allowed at root level of program";var m=p?function(e,t){t=t.toLowerCase();var n=e.createBiquadFilter();return n.type=o[t.substr(0,5)]||o[t.substr(0,2)]||"lowpass",n}(e,h):l(e,h);(m.start&&m.start(r),t.nodes.push(m),v)&&k(e,m.frequency||m.playbackRate,t,a,r,n.freq,"freq",s,!1);if(d&&k(e,m.Q,t,a,r,n.Q,"Q",s,!1),f){if(!m.gain){var g=e.createGain();t.nodes.push(g),m.connect(g),m=g}p&&(c=!1),k(e,m.gain,t,a,r,n.gain,"gain",s,c)}return m}function F(e){var t={},n=[],a=new g(e);function r(e){for(;n.length>e;){var a=n.shift();c(t[a]),delete t[a]}}function i(){for(var a=e.currentTime,r=0;r<n.length;r++){var i=n[r],s=t[i];0===s.endTime||a<s.endTime||(c(s),delete t[i],n.splice(r,1),r--)}}this.maxVoices=32,this.play=function(a,s,u,c,h,p){i(),r(this.maxVoices-1);var f=function(t,n,a,r,i){var s=new o(r),u=e.createGain();s.nodes.push(u);for(var l=0;l<t.length;l++){var c=t[l],h=C(e,s,c,n,r,"",!0);h.Q?(u.connect(h),u=e.createGain(),s.nodes.push(u),h.connect(u)):h.connect(u)}if(1===a)u.connect(i);else{var p=e.createGain();s.nodes.push(p),p.gain.value=a<1?a*a:a,u.connect(p),p.connect(i)}return s}(a,s,u,c,p);return n.push(f.id),t[f.id]=f,h&&l(f,h),f.id},this.bend=function(e,n,a,r){var i=t[e];i&&function(e,t,n,a){if(e.endTime>0)return;e.bendables.forEach(e=>{var r=t*e.mult;e.param.cancelScheduledValues(a),e.param.setTargetAtTime(r,a,n)})}(i,n,a,r)},this.release=function(e,n){var a=t[e];a&&l(a,n)},this.isPlaying=function(e){return!!t[e]},this.releaseAll=function(e){n.forEach(n=>{l(t[n],e)})},this.dispose=function(){r(0),t=null,n=null,clearInterval(s)};var s=setInterval(i,800);function o(e){++u>9999&&(u=1),this.id=u,this.time=+e,this.endTime=0,this.nodes=[],this.envelopes=[],this.bendables=[]}var u=0;function l(e,t){e.endTime>0||(e.endTime=t,e.envelopes.forEach((n,r)=>{var i=n.releaseTime;if(i>=0){var s=n.param;a.startEnvelope(s,t);var o=n.releaseTarget||0;if(a.addSweep(s,-1,o,i),n.rootEnvelope){var u=t+4*i;e.endTime=Math.max(e.endTime,u)}}}))}function c(e){for(;e.nodes.length>0;){var t=e.nodes.pop();t.stop&&t.stop(),t.buffer&&(t.buffer=null),t.gain&&t.gain.cancelScheduledValues(0),t.frequency&&t.frequency.cancelScheduledValues(0),t.playbackRate&&t.playbackRate.cancelScheduledValues(0),t.Q&&t.Q.cancelScheduledValues(0),t.disconnect(),t=null}e.nodes=null,e.envelopes=null,e.bendables=null}}function P(e,t,n){var a=this,r=e||new AudioContext,i=new F(r),s=t||r.destination,o=()=>r.currentTime+.05;function u(){l&&l.disconnect(),n||((l=r.createDynamicsCompressor()).threshold.value=-24,l.knee.value=25,l.ratio.value=20,l.attack.value=.003,l.release.value=.25,l.connect(s),a.compressor=l)}this.play=function(e,t,n,a,u,c){return"running"!==r.state&&r.resume(),t=t||440,n=n||1,a=a||o(),u=u||0,c=c||l||s,e=function(e){Array.isArray(e)||(e=[]);for(var t=0;t<e.length;t++)"object"!=typeof e[t]&&(e.splice(t,1),t--);0===e.length&&e.push({});return e}(e),i.play(e,t,n,a,u,c)},this.bend=function(e,t,n,a){t=t||440,n=n||.1,a=a||o(),i.bend(e,t,n,a)},this.release=function(e,t){t=t||o(),i.release(e,t)},this.noteIsPlaying=function(e){return i.isPlaying(e)},this.releaseAll=function(e){e=e||o(),i.releaseAll(e)},this.compressor=null,this.now=function(){return r.currentTime},this.maxVoices=function(e){return e&&(i.maxVoices=e),i.maxVoices},this.destination=function(e){return e&&(s=e,u()),s},this.audioContext=function(e){return e&&(this.dispose(),i=new F(r=e),s=r.destination,u()),r};var l=null;u(),this.dispose=function(){i.dispose(),i=null,l&&l.disconnect(),l=null,s=null,r=null}}class D{constructor(e){this.gen=new P(e.context,e.input,!0),this.timeUntilNextBeat=0,this._bts=e.beatsToSeconds}playSound(e,t,n,a,r,i){r=r||0,a=a||.75;var s=this.gen.now()+this.timeUntilNextBeat,o=s+this._bts(r),u=s+this._bts(r+a);i=i||1;var l=440*Math.pow(2,(e-69)/12);this.gen.play(t,l,i,o,u,n)}}class z{constructor(e,t,n,a,r,i){this._now=()=>e.currentTime,this._gain=null,this._comp=null,this._pan=null,this._player=n,this.dest=null,this.program=[{}],this.beforeBeat=e=>{},this.onBeat=e=>{};var s=t;"number"==typeof r&&(s=this._pan=function(e,t,n){var a=e.createStereoPanner();return a.pan.setValueAtTime(t,0),a.connect(n),a}(e,r,s)),a&&(s=this._gain=function(e,t,n){var a=e.createGain();return a.gain.setValueAtTime(t,0),a.connect(n),a}(e,a,s)),i&&(s=this._comp=function(e,t,n){var a=e.createDynamicsCompressor(t||null);return a.connect(n),a}(e,i,s)),this.dest=s}setPan(e,t){this._pan&&this._pan.pan.setTargetAtTime(e,this._now(),t||.05)}setGain(e,t){this._gain&&this._gain.gain.setTargetAtTime(e,this._now(),t||.05)}playSound(e,t,n,a,r,i){r=r||this.program,i=i||this.dest,this._player.playSound(e,r,i,t,n,a)}playPattern(e,t,n,a){for(var r=a.split(/\s+/),i=r[e%r.length],s=i.length/4,o=t*s,u=(t+1)*s,l=1/s,c=Math.ceil(o-.01);c<u-.01;c++)if("-"!==i[c]){var h=c*l-t;this.playSound(n,l,h)}}dispose(){setTimeout(e=>{var t=[e._pan,e._gain,e._comp];for(var n in t.forEach(e=>{e&&e.disconnect()}),e)e[n]=null},1e3,this)}}function I(e){if(0===e)return"#000";var t=Math.round(130*e-80),n=Math.round(20+50*e);return e>.99&&(n+=30),`hsl(${t},100%,${n}%)`}var G=null;var N=null;var Q=[30,40,50,80,100,105,110,150,160],U=Q.map(e=>0);function L(e,t,n){for(var a=0,r=t;r<n;r++)if(e[r]<0&&a++,e[r]>0&&a>5)return r;return-1}var W=null;var $="",H=!1,J=new function(e){e||(e=new AudioContext);var t=new a(e,60);t.onBeat=e=>this.onBeat(e);var n=function(e){var t=e.createDynamicsCompressor();return t.threshold.value=-30,t.knee.value=25,t.ratio.value=12,t.attack.value=.003,t.release.value=.25,t}(e),i=e.createGain();n.connect(i),i.connect(e.destination),this.input=n,this.output=i;var s=t=>{var n=t<1?t*t:t,a=e.currentTime;i.gain.cancelScheduledValues(0),i.gain.setTargetAtTime(n,a,.04)};this.context=e,this.beat=0,this.swing=0,this.playing=!1,this.volume=1,this.bpm=60,r(this,"playing",this.playing,e=>{e?(this.context.resume(),s(this.volume)):(s(0),setTimeout(()=>{this.context.suspend()},100)),t.playing=e}),r(this,"volume",this.volume,s),r(this,"bpm",this.bpm,e=>t.bpm=e),this.onBeat=e=>{},this.beatsToSeconds=e=>{e=+e;var n=Math.floor(e);if(e>n){var a=e-n;e=n+Math.pow(a,1-.75*this.swing)}return t.beatsToSeconds(e)}},K=new function(e){var t,a,r,i=e.context,s=e.input,o=new D(e),u={},l={},c=(e,t)=>new t(l,(t,n)=>((e,t,n)=>{var a=t||{},r=new z(i,s,o,a.gain,a.pan,a.comp);return u[e]=u[e]||[],u[e].push(r),n(r),r})(e,t,n)),h={};t=(e,t)=>{if(u[e])for(;u[e].length;)u[e].pop().dispose();h[e]=c(e,t.default||t)},a={},(r=n(1)).keys().forEach(e=>(e=>{var n=r.resolve(e),i=r(e);i!==a[n]&&(t(n,i,a[n]||null),a[n]=i)})(e));var p=0;e.onBeat=e=>{o.timeUntilNextBeat=e;var t=Math.floor(p/4),n=p%4;Object.keys(u).forEach(e=>{u[e].forEach(e=>e.beforeBeat(t,n))}),Object.keys(u).forEach(e=>{u[e].forEach(e=>e.onBeat(t,n))}),p++}}(J);J.volume=.75,J.swing=0,J.bpm=100;var X=()=>{"suspended"===J.context.state&&J.context.resume(),J.playing=!J.playing,Y.playMsg=J.playing?"Stop":"Start",Y.log=J.playing?"(playing)":""},Y=new(0,window.Vue)({data:{playMsg:"Start",volume:J.volume,swing:J.swing,bpm:J.bpm,log:"",vizLabel:"(click to toggle visualizer)"},methods:{setVolume:e=>{J.volume=Y.volume},setSwing:e=>{J.swing=Y.swing},setBPM:e=>{J.bpm=Y.bpm},play:()=>X(),cycleViz:()=>function(){Z=(Z+1)%4,te.mode=Z-1,te.paused=0===Z,0===Z&&te.clear("#FFF");Y.vizLabel=0===Z?"(click to toggle visualizer)":""}()}}).$mount("#ui");window.onkeydown=e=>{" "===e.key&&(e.preventDefault(),X())};var Z=0,ee=document.querySelector(".viz"),te=new class{constructor(e,t,n,a,r){if(this.paused=!1,this.mode=r||0,this.minDb=-96,this.maxDb=-15,this.minFreq=150,this.maxFreq=15e3,this._ctx=e,this._canvasCtx=t.getContext("2d"),this._analyser=e.createAnalyser(),this._input=null,this._lastMode=-1,this.setInput(n),(a=a||30)>=60){var i=()=>{this.render(),requestAnimationFrame(i)};requestAnimationFrame(i)}else setInterval(()=>this.render(),1e3/a)}setInput(e){this._input&&this._input.disconnect(this._analyser),e.connect(this._analyser),this._input=e}render(){(function(e){var t=e._ctx.state;$||($=t);if(t===$)return;$=t,"suspended"===t&&(H=!0);if("running"===t&&H)return e._input.disconnect(e._analyser),e._analyser=e._ctx.createAnalyser(),e._input.connect(e._analyser),H=!1,!0})(this)||this.paused||"running"===this._ctx.state&&(0===this.mode&&function(e){var t=e._analyser,n=e._canvasCtx;t.fftSize=1024;var a=t.frequencyBinCount;G||(G=new Uint8Array(a));t.getByteFrequencyData(G);var r=G;e.clear();for(var i=n.canvas.width,s=n.canvas.height,o=Math.log2(e.maxFreq),u=Math.log2(e.minFreq),l=e._ctx.sampleRate/2,c=t.frequencyBinCount,h=0;h<i;h++){var p=h/(i-1),f=Math.pow(2,u+p*(o-u)),v=Math.round(f/l*c),d=r[v]/255,m=d*s;n.fillStyle=I(d),n.fillRect(h,s-m,1,m)}}(this),1===this.mode&&function(e){var t=e._analyser,n=e._canvasCtx;t.fftSize=4096,t.minDecibels=e.minDb,t.maxDecibels=e.maxDb;var a=t.frequencyBinCount;N||(N=new Float32Array(a));t.getFloatTimeDomainData(N);var r=N;e.clear();var i=n.canvas.width,s=n.canvas.height,o=function(e){var t=[],n=0;for(;t.length<8&&n>=0;)(n=L(e,n,e.length/2))>0&&t.push(n);if(t.length<2)return t[0]||0;n=0;var a=999999.9;return t.forEach(t=>{var r=function(e,t){return Q.reduce((n,a,r)=>{var i=t[e+a];return n+Math.abs(i-U[r])},0)}(t,e);r>a||(a=.95*r-1,n=t)}),U=Q.map(t=>e[t+n]),n}(r);n.lineWidth=2,n.beginPath(),n.moveTo(0,s/2);for(var u=a/2,l=0,c=0;c<u;c++){var h=c+o,p=h<a?N[h]:0;p>l&&(l=p);var f=i*c/u,v=s*(.5*(p+1));n.lineTo(f,s-v)}n.strokeStyle=I(Math.max(.2,l)),n.stroke()}(this),2===this.mode&&function(e,t){var n=e._analyser,a=e._canvasCtx;n.fftSize=1024,n.smoothingTimeConstant=.3,n.minDecibels=e.minDb,n.maxDecibels=e.maxDb;var r=n.frequencyBinCount;W||(W=new Uint8Array(r));n.getByteFrequencyData(W);var i=W,s=a.canvas.width,o=a.canvas.height;t?(a.fillStyle=I(0),a.fillRect(0,0,s,o)):a.drawImage(a.canvas,-1,0,s,o);for(var u=Math.log2(e.maxFreq),l=Math.log2(e.minFreq),c=e._ctx.sampleRate/2,h=n.frequencyBinCount,p=0;p<o;p++){var f=(o-1-p)/(o-1),v=Math.pow(2,l+f*(u-l)),d=Math.round(v/c*h),m=i[d]/255;a.fillStyle=I(m),a.fillRect(s-1,p,1,1)}}(this,this.mode!==this._lastMode),this._lastMode=this.mode)}clear(e){var t=this._canvasCtx.canvas.width,n=this._canvasCtx.canvas.height;this._canvasCtx.fillStyle=e||I(0),this._canvasCtx.fillRect(0,0,t,n)}}(J.context,ee,J.output,20,0);te.paused=!0,te.clear("#FFF"),window.vm=Y,window.viz=te,window.engine=J,window.manager=K}]);